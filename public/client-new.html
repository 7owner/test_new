<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Créer un Nouveau Client</title>
    <link rel="stylesheet" href="custom.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div id="navbar-placeholder"></div>

    <div class="container mt-5">
        <h1 class="mb-4">Créer un Nouveau Client</h1>
        <form id="clientRegistrationForm">
            <div class="mb-3">
                <label for="email" class="form-label">Email (Utilisateur)</label>
                <input type="email" class="form-control" id="email" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Mot de passe (Utilisateur)</label>
                <input type="password" class="form-control" id="password" required>
            </div>
            <div class="mb-3">
                <label for="nom_client" class="form-label">Nom du Client (Entreprise)</label>
                <input type="text" class="form-control" id="nom_client" required>
            </div>
            <div class="mb-3">
                <label for="representant_nom" class="form-label">Nom du Représentant</label>
                <input type="text" class="form-control" id="representant_nom">
            </div>
            <div class="mb-3">
                <label for="representant_email" class="form-label">Email du Représentant</label>
                <input type="email" class="form-control" id="representant_email">
            </div>
            <div class="mb-3">
                <label for="representant_tel" class="form-label">Téléphone du Représentant</label>
                <input type="tel" class="form-control" id="representant_tel">
            </div>
            <div class="mb-3">
                <label for="adresse_id" class="form-label">ID Adresse (Optionnel)</label>
                <input type="number" class="form-control" id="adresse_id">
            </div>
            <div class="mb-3">
                <label for="commentaire" class="form-label">Commentaire (Optionnel)</label>
                <textarea class="form-control" id="commentaire" rows="3"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Créer Client</button>
        </form>
        <div id="message" class="mt-3"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="nav.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('clientRegistrationForm');
            const messageDiv = document.getElementById('message');

            form.addEventListener('submit', async (event) => {
                event.preventDefault();

                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const nom_client = document.getElementById('nom_client').value;
                const representant_nom = document.getElementById('representant_nom').value;
                const representant_email = document.getElementById('representant_email').value;
                const representant_tel = document.getElementById('representant_tel').value;
                const adresse_id = document.getElementById('adresse_id').value;
                const commentaire = document.getElementById('commentaire').value;

                const token = localStorage.getItem('jwtToken'); // Récupérer le token JWT

                try {
                    const response = await fetch('/api/clients/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            email,
                            password,
                            nom_client,
                            representant_nom,
                            representant_email,
                            representant_tel,
                            adresse_id: adresse_id ? parseInt(adresse_id) : null,
                            commentaire
                        })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        messageDiv.className = 'alert alert-success';
                        messageDiv.textContent = data.message || 'Client créé avec succès!';
                        form.reset();
                    } else {
                        messageDiv.className = 'alert alert-danger';
                        messageDiv.textContent = data.error || 'Erreur lors de la création du client.';
                    }
                } catch (error) {
                    console.error('Erreur réseau ou inattendue:', error);
                    messageDiv.className = 'alert alert-danger';
                    messageDiv.textContent = 'Erreur de connexion au serveur.';
                }
            });
        });
    </script>
</body>
</html>